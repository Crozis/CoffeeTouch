/*! CoffeeTouch v0.1.0 - 2014-02-16 */
(function(){var a,b,c,d,e,f,g,h,i,j,k,l={}.hasOwnProperty,m=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};a=function(){function a(a,b){var c;this.totalNbFingers=a,this.targetElement=b,this.fingersArray={},this.fingers=[],this.firstAnalysis=!0,this.informations={},this.informations={},this.informations.fingers=[],this.informations.firstTrigger=!0,c=new Date,this.fingerArraySize=0,this.informations.timeStart=c.getTime()}return a.prototype.notify=function(a,b,c){var d,e,g,h,i;for(this.eventObj=c,this.informations.rotation=this.eventObj.global.rotation,this.informations.scale=this.eventObj.global.scale,this.informations.targets=[],i=this.eventObj.global.event.targetTouches,g=0,h=i.length;h>g;g++)e=i[g],this.informations.targets.push(e.target);return d=new Date,this.informations.timeElapsed=d.getTime()-this.informations.timeStart,null!=this.fingersArray[a]?this.fingersArray[a].update(b,this.eventObj):(this.fingersArray[a]=new f(a,b,this.eventObj),this.fingers.push(this.fingersArray[a]),this.fingerArraySize++),this.fingerArraySize===this.totalNbFingers?this.analyse(this.totalNbFingers):void 0},a.prototype.analyse=function(){var a,b,c,d;for(this.firstAnalysis&&this.init(),this.gestureName=[],d=this.fingers,b=0,c=d.length;c>b;b++)a=d[b],this.gestureName.push(a.gestureName);return this.targetElement.makeGesture(this.gestureName,this.informations),this.triggerDrag(),this.triggerFixed(),this.triggerFlick(),this.informations.firstTrigger?this.informations.firstTrigger=!1:void 0},a.prototype.init=function(){var a,b,c;for(this.fingers=this.fingers.sort(function(a,b){return Math.abs(a.params.startX-b.params.startX)<15?a.params.startY-b.params.startY:a.params.startX-b.params.startX}),this.informations.nbFingers=this.fingers.length,a=b=0,c=this.fingers.length-1;c>=0?c>=b:b>=c;a=c>=0?++b:--b)this.informations.fingers[a]=this.fingers[a].params;return this.firstAnalysis=!1},a.prototype.triggerDrag=function(){return b.Helper.arrayContains(this.gestureName,"drag")&&(this.triggerDragDirections(),this.gestureName.length>1)?(this.triggerPinchOrSpread(),this.triggerRotation()):void 0},a.prototype.triggerDragDirections=function(){var a,c,d,e,f;for(c=[],f=this.fingers,d=0,e=f.length;e>d;d++)a=f[d],c.push(a.params.dragDirection);return b.Helper.stringContains(c,"unknown")?void 0:this.targetElement.makeGesture(c,this.informations)},a.prototype.triggerPinchOrSpread=function(){var a;return a=!1,this.informations.scale<1.1&&!a?(this.targetElement.makeGesture(""+b.Helper.digit_name(this.fingers.length)+":pinch",this.informations),this.targetElement.makeGesture("pinch",this.informations)):this.informations.scale>1.1&&!a?(this.targetElement.makeGesture(""+b.Helper.digit_name(this.fingers.length)+":spread",this.informations),this.targetElement.makeGesture("spread",this.informations)):void 0},a.prototype.triggerFixed=function(){var a,c,d,e,f,g;if(this.gestureName.length>1&&b.Helper.arrayContains(this.gestureName,"fixed")){for(a=!1,d=[],g=this.fingers,e=0,f=g.length;f>e;e++){if(c=g[e],"drag"===c.gestureName&&"triggerDrag"===c.params.dragDirection){a=!0;break}d.push("drag"===c.gestureName?c.params.dragDirection:"fixed")}if(!a)return this.targetElement.makeGesture(d,this.informations)}},a.prototype.triggerFlick=function(){var a,c,d,e,f,g,h;if(b.Helper.arrayContains(this.gestureName,"dragend")){for(d=[],e=[],a=!1,h=this.fingers,f=0,g=h.length;g>f;f++)c=h[f],"unknown"===c.params.dragDirection&&(a=!0),c.isFlick?(d.push("flick:"+c.params.dragDirection),e.push("flick")):(d.push(c.params.dragDirection),e.push(c.params.dragDirection));if(!a)return this.targetElement.makeGesture(d,this.informations),this.targetElement.makeGesture(e,this.informations)}},a.prototype.triggerRotation=function(){var a;return null==this.lastRotation&&(this.lastRotation=this.informations.rotation),a="",a=this.informations.rotation>this.lastRotation?"rotate:cw":"rotate:ccw",this.targetElement.makeGesture(a,this.informations),this.targetElement.makeGesture("rotate",this.informations),this.targetElement.makeGesture(""+b.Helper.digit_name(this.fingers.length)+":"+a,this.informations),this.targetElement.makeGesture(""+b.Helper.digit_name(this.fingers.length)+":rotate",this.informations)},a}(),e=function(){function a(a){this.element=a,this.grouper=new d,this.machines={},this.element.addEventListener("touchstart",function(a){return function(b){return a.touchstart(b)}}(this)),this.element.addEventListener("touchend",function(a){return function(b){return a.touchend(b)}}(this)),this.element.addEventListener("touchmove",function(a){return function(b){return a.touchmove(b)}}(this))}return a.prototype.touchstart=function(a){var c,d,e,f,g,h;for(b.Options.preventDefault&&a.preventDefault(),this.fingerCount=a.touches.length,this.grouper.refreshFingerCount(this.fingerCount,this.element),g=a.changedTouches,h=[],e=0,f=g.length;f>e;e++)c=g[e],this.machines[c.identifier]?h.push(void 0):(this.addGlobal(a,c),d=new k(c.identifier,this),d.apply("touchstart",c),h.push(this.machines[c.identifier]=d));return h},a.prototype.touchend=function(a){var c,d,e,f,g,h;b.Options.preventDefault&&a.preventDefault();for(d in this.machines){for(d=parseInt(d),c=!1,h=a.touches,f=0,g=h.length;g>f;f++)e=h[f],e.identifier===d&&(c=!0);c||null==this.machines[d]||(this.machines[d].apply("touchend",this.addGlobal(a,{})),delete this.machines[d])}return this.fingerCount=a.touches.length,this.grouper.refreshFingerCount(this.fingerCount,this.element)},a.prototype.touchmove=function(a){var c,d,e,f,g,h;for(b.Options.preventDefault&&a.preventDefault(),g=a.changedTouches,h=[],e=0,f=g.length;f>e;e++)c=g[e],null==this.machines[c.identifier]&&(d=new k(c.identifier,this),d.apply("touchstart",c),this.machines[c.identifier]=d),this.addGlobal(a,c),h.push(this.machines[c.identifier].apply("touchmove",c));return h},a.prototype.addGlobal=function(a,b){return b.global={},b.global={scale:a.scale,rotation:a.rotation,event:a}},a.prototype.broadcast=function(a,b){return this.grouper.receive(a,b,this.fingerCount,this.element)},a}(),d=function(){function b(){this.savedTap={},this.fixedSave={},this.fingerCount=0}return b.prototype.refreshFingerCount=function(b,c){return 0===b&&(this.fingerCount=-1),this.fingerCount<b?(this.fingerCount=b,this.analyser=new a(this.fingerCount,c)):void 0},b.prototype.receive=function(a,b){var c;return this.send(a,b),"tap"===a?("undefined"!=typeof this.first?(c=(new Date).getTime()-this.last,this.first=!1):this.first=!0,!this.first&&300>c?this.send("doubletap",b):(this.savedTap[b.identifier]={},this.savedTap[b.identifier].event=b,this.savedTap[b.identifier].time=(new Date).getTime()),this.last=(new Date).getTime()):void 0},b.prototype.send=function(a,b){var c;if("fixed"===a)this.fixedSave[b.identifier]=b;else if("fixedend"===a)for(c in this.fixedSave)b.identifier===parseInt(c)&&delete this.fixedSave[c];return this.analyser.notify(b.identifier,a,b)},b}(),f=function(){function a(a,b,c){var d;this.fingerId=a,this.gestureName=b,d=new Date,this.params={},this.positions=[],this.positions[0]={x:c.clientX,y:c.clientY,time:d.getTime()},this.positionCount=0,this.params.startX=c.clientX,this.params.startY=c.clientY,this.params.timeStart=d.getTime(),this.params.timeElapsed=0,this.params.panX=0,this.params.panY=0,this.params.gestureName=this.gestureName,this.updatePosition(c),this.params.speed=0,this.params.dragDirection="unknown",this.isFlick=!1}return a.prototype.update=function(a,c){var d,e,f;return this.gestureName=a,this.positionCount++,d=new Date,this.positions[this.positionCount]={x:c.clientX,y:c.clientY,time:d.getTime()},this.params.timeElapsed=d.getTime()-this.params.timeStart,this.updatePosition(c),"drag"===this.gestureName&&(e=this.params.x-this.positions[this.positionCount-1].x,f=this.params.y-this.positions[this.positionCount-1].y,this.params.speed=Math.sqrt(e*e+f*f)/(this.positions[this.positionCount].time-this.positions[this.positionCount-1].time),this.params.dragDirection=b.Helper.getDragDirection(this)),"dragend"===this.gestureName&&(this.params.speed>b.Options.flickSpeed||this.params.timeElapsed<b.Options.flickTimeElapsed)?this.isFlick=!0:void 0},a.prototype.updatePosition=function(a){return this.params.x=a.clientX,this.params.y=a.clientY,this.params.panX=this.params.x-this.params.startX,this.params.panY=this.params.y-this.params.startY},a}(),b=b||{},b.Helper=b.Helper||{},b.Options={preventDefault:!1,flickSpeed:.5,flickTimeElapsed:100},Element.prototype.onGesture=function(a,c,d){var f,g;return b.Helper.mergeObjects(b.Options,d),null==this.router&&(this.router=new e(this)),f=this._callbacks||(this._callbacks={}),g=this._callbacks[a]||(this._callbacks[a]=[]),g.push(c),this},Element.prototype.unbindGesture=function(a,b){var c,d,e,f,g,h;if(a){if(d=this._callbacks)if(b){if(f=d[a],!f)return this;for(e=g=0,h=f.length;h>g;e=++g)if(c=f[e],b===c){f.splice(e,1);break}}else d[a]=[]}else this._callbacks={};return this},Element.prototype.makeGesture=function(a){var b,c,d,e,f,g,h;if(!(c=this._callbacks))return this;if(d=c[a])for(e=0,g=d.length;g>e;e++)b=d[e],b.apply(this,Array.prototype.slice.call(arguments,1));if(d=c.all)for(f=0,h=d.length;h>f;f++)b=d[f],b.apply(this,arguments);return this},b.Helper.stringContains=function(a,b){return-1!==a.indexOf(b)},b.Helper.arrayContains=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)if(c=a[d],c===b)return!0;return!1},b.Helper.mergeObjects=function(a,b){var c;for(c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a},b.Helper.distanceBetweenTwoPoints=function(a,b,c,d){return Math.sqrt((c-a)*(c-a)+(d-b)*(d-b))},b.Helper.getDirection=function(a,b){return a===b&&0===b?"unknown":Math.abs(a)>Math.abs(b)?0>a?"left":"right":0>b?"up":"down"},b.Helper.getDragDirection=function(a){var c,d;return c=a.params.x-a.positions[a.positionCount-1].x,d=a.params.y-a.positions[a.positionCount-1].y,b.Helper.getDirection(c,d)},b.Helper.digit_name=function(){var a;return a=["zero","one","two","three","four","five","six","seven","eight","nine","ten"],function(b){return a[b]}}(),"undefined"!=typeof jQuery&&null!==jQuery&&!function(a){return a.fn.onGesture=function(a,b,c){return this.each(function(d,e){return e.onGesture(a,b,c)})},a.fn.unbindGesture=function(a,b){return this.each(function(c,d){return d.unbindGesture(a,b)})},a.fn.makeGesture=function(a){return this.each(function(b,c){return c.makeGesture(a)})}}(jQuery),k=function(){function b(b,c){this.identifier=b,this.router=c,this.currentState=new j(this),this.analyser=new a}return b.prototype.apply=function(a,b){return this.currentState.apply(a,b)},b.prototype.setState=function(a){return this.currentState=a},b.prototype.getState=function(){return this.currentState},b}(),i=function(){function a(a){this.machine=a,this.eventObj=null!=this.machine.currentState?this.machine.currentState.eventObj:{},this.init()}return a.prototype.init=function(){},a.prototype.apply=function(a,c){return b.Helper.mergeObjects(this.eventObj,c),this[a]()},a.prototype.touchstart=function(){},a.prototype.touchmove=function(){},a.prototype.touchend=function(){},a.prototype.notify=function(a){return this.machine.router.broadcast(a,this.eventObj)},a}(),j=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.touchstart=function(){return this.machine.setState(new g(this.machine))},b}(i),g=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.init=function(){var a;return a=this.machine,this.fixedtimer=setTimeout(function(){return a.setState(new h(a))},300)},b.prototype.touchend=function(){return clearTimeout(this.fixedtimer),this.notify("tap"),this.machine.setState(new j(this.machine))},b.prototype.touchmove=function(){return clearTimeout(this.fixedtimer),this.notify("drag"),this.machine.setState(new c(this.machine))},b}(i),h=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.init=function(){return this.notify("fixed")},b.prototype.touchend=function(){return this.notify("fixedend"),this.machine.setState(new j(this.machine))},b}(i),c=function(a){function b(){return b.__super__.constructor.apply(this,arguments)}return m(b,a),b.prototype.init=function(){var a;return this.isTap=!0,this.initialX=this.eventObj.clientX,this.initialY=this.eventObj.clientY,this.delta=15,a=this,setTimeout(function(){return a.isTap=!1},150)},b.prototype.touchmove=function(){return this.notify("drag")},b.prototype.touchend=function(){return this.notify(this.isTap&&Math.abs(this.eventObj.clientX-this.initialX)<this.delta&&Math.abs(this.eventObj.clientY-this.initialY)<this.delta?"tap":"dragend"),this.machine.setState(new j(this.machine))},b}(i)}).call(this);