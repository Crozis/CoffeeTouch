<!DOCTYPE html>  <html> <head>   <title>Analyzer.coffee</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>            <div id="jump_to">         Jump To &hellip;         <div id="jump_wrapper">           <div id="jump_page">                                           <a class="source" href="Analyzer.html">                 Analyzer.coffee               </a>                                           <a class="source" href="AnalyzerHelper.html">                 AnalyzerHelper.coffee               </a>                                           <a class="source" href="EventRouter.html">                 EventRouter.coffee               </a>                                           <a class="source" href="Finger.html">                 Finger.coffee               </a>                                           <a class="source" href="MethodsHelper.html">                 MethodsHelper.coffee               </a>                                           <a class="source" href="StateMachine.html">                 StateMachine.coffee               </a>                        </div>         </div>       </div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               Analyzer.coffee             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>               <p>Analyse and trigger events sent by the Event Router</p>

<p>Copyright (c) 2011<br />
Publication date: 06/17/2011<br />
    Pierre Corsini (pcorsini@polytech.unice.fr)<br />
    Nicolas Dupont (npg.dupont@gmail.com)<br />
    Nicolas Fernandez (fernande@polytech.unice.fr)<br />
    Nima Izadi (nim.izadi@gmail.com)<br />
    And supervised by RaphaÃ«l Bellec (r.bellec@structure-computation.com)<br /></p>

<p>Permission is hereby granted, free of charge, to any person obtaining a 
copy of this software and associated documentation files (the "Software"),
to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense, 
and/or sell copies of the Software, and to permit persons to whom the Software 
is furnished to do so, subject to the following conditions:</p>

<p>The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.</p>

<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS 
OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE 
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR
IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>             </td>             <td class="code">               <div class="highlight"><pre></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>Analyser <br />
Analyse a gesture and "notify" the @targetElement that "a given gesture" has been made.<br />
Params:<br />
    totalNbFingers :    Number of finger of the gesture beeing made.<br />
  targetElement : DOM Element which will be informed of the gesture</p>             </td>             <td class="code">               <div class="highlight"><pre><span class="k">class</span> <span class="nx">Analyser</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Create an analyser object with total number of fingers and an array of all fingers as attribute</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">constructor: </span><span class="nf">(@totalNbFingers, @targetElement) -&gt;</span>
		<span class="vi">@fingersArray = </span><span class="p">{}</span> <span class="c1"># Hash with fingerId: fingerGestureObject</span>
		<span class="vi">@fingers = </span><span class="p">[]</span> <span class="c1"># Array with all fingers		</span>
		<span class="vi">@firstAnalysis = </span><span class="kc">true</span> <span class="c1"># To know if we have to init the informations which will be returned</span>
		<span class="vi">@informations = </span><span class="p">{}</span> <span class="c1"># All informations which will be send with the event gesture</span>
		<span class="vi">@informations = </span><span class="p">{}</span> <span class="c1"># Informations corresponding to all fingers</span>
		<span class="vi">@informations.fingers = </span><span class="p">[]</span>
		<span class="vi">@informations.firstTrigger = </span><span class="kc">true</span>
		<span class="nv">date = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
		<span class="vi">@fingerArraySize = </span><span class="mi">0</span>
		<span class="vi">@informations.timeStart = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span>
		</pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Notify the analyser of a gesture (gesture name, fingerId and parameters of new position etc)</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">notify: </span><span class="nf">(fingerID, gestureName, @eventObj) -&gt;</span>
		<span class="vi">@informations.rotation = </span><span class="nx">@eventObj</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">rotation</span> 
		<span class="vi">@informations.scale = </span><span class="nx">@eventObj</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">scale</span>
		<span class="vi">@informations.target = </span><span class="nx">@eventObj</span><span class="p">.</span><span class="nx">global</span><span class="p">.</span><span class="nx">event</span><span class="p">.</span><span class="nx">targetTouches</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="nv">date = </span><span class="k">new</span> <span class="nb">Date</span><span class="p">()</span>
		<span class="vi">@informations.timeElapsed = </span><span class="nx">date</span><span class="p">.</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">-</span> <span class="nx">@informations</span><span class="p">.</span><span class="nx">timeStart</span>
		<span class="k">if</span> <span class="nx">@fingersArray</span><span class="p">[</span><span class="nx">fingerID</span><span class="p">]</span><span class="o">?</span>
			<span class="nx">@fingersArray</span><span class="p">[</span><span class="nx">fingerID</span><span class="p">].</span><span class="nx">update</span> <span class="nx">gestureName</span><span class="p">,</span> <span class="nx">@eventObj</span>
		<span class="k">else</span>
			<span class="nx">@fingersArray</span><span class="p">[</span><span class="nx">fingerID</span><span class="p">]</span> <span class="o">=</span>  <span class="k">new</span> <span class="nx">FingerGesture</span><span class="p">(</span><span class="nx">fingerID</span><span class="p">,</span> <span class="nx">gestureName</span><span class="p">,</span> <span class="nx">@eventObj</span><span class="p">)</span>
			<span class="nx">@fingers</span><span class="p">.</span><span class="nx">push</span> <span class="nx">@fingersArray</span><span class="p">[</span><span class="nx">fingerID</span><span class="p">]</span>
			<span class="nx">@fingerArraySize</span><span class="o">++</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Analyse event only when it receives the information from each fingers of the gesture.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nx">@analyse</span> <span class="nx">@totalNbFingers</span> <span class="k">if</span> <span class="nx">@fingerArraySize</span> <span class="o">is</span> <span class="nx">@totalNbFingers</span>
	</pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>Analayse precisly the gesture.
Is called only when the analyser has been informed that all fingers have done a basic gesture.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">analyse: </span><span class="nf">(nbFingers) -&gt;</span>
		<span class="nx">@init</span><span class="p">()</span> <span class="k">if</span> <span class="nx">@firstAnalysis</span>
		<span class="vi">@gestureName = </span><span class="p">[]</span>
		<span class="nx">@gestureName</span><span class="p">.</span><span class="nx">push</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">gestureName</span> <span class="k">for</span> <span class="nx">finger</span> <span class="k">in</span> <span class="nx">@fingers</span>
		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">@gestureName</span><span class="p">,</span> <span class="nx">@informations</span>
		<span class="nx">@generateGrouppedFingerName</span><span class="p">()</span>
		<span class="nx">@triggerDrag</span><span class="p">()</span>
		<span class="nx">@triggerFixed</span><span class="p">()</span>
		<span class="nx">@triggerFlick</span><span class="p">()</span>
		<span class="vi">@informations.firstTrigger = </span><span class="kc">false</span> <span class="k">if</span> <span class="nx">@informations</span><span class="p">.</span><span class="nx">firstTrigger</span>
	</pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Sort fingers and initialize some informations that will be triggered to the user
Is called before analysis</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">init: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Sort fingers. Left to Right and Top to Bottom</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="vi">@fingers = </span><span class="nx">@fingers</span><span class="p">.</span><span class="nx">sort</span> <span class="nf">(a,b) -&gt;</span>
			<span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">startY</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">startY</span> <span class="k">if</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">abs</span><span class="p">(</span><span class="nx">a</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">startX</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">startX</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">15</span>
			<span class="k">return</span> <span class="nx">a</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">startX</span> <span class="o">-</span> <span class="nx">b</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">startX</span>
		<span class="vi">@informations.nbFingers = </span><span class="nx">@fingers</span><span class="p">.</span><span class="nx">length</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>For each finger, assigns to the information's event the information corresponding to this one.</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="k">for</span> <span class="nx">i</span> <span class="k">in</span> <span class="p">[</span><span class="mi">0</span><span class="p">..</span><span class="nx">@fingers</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
			<span class="nx">@informations</span><span class="p">.</span><span class="nx">fingers</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">@fingers</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">params</span>
		<span class="vi">@firstAnalysis = </span><span class="kc">false</span>
	</pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>Trigger all names related to the drag event</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">triggerDrag: </span><span class="o">-&gt;</span> 
		<span class="k">if</span> <span class="nx">@gestureName</span><span class="p">.</span><span class="nx">contains</span> <span class="s2">&quot;drag&quot;</span>
			<span class="nx">@triggerDragDirections</span><span class="p">()</span>
			<span class="k">if</span> <span class="nx">@gestureName</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span>
				<span class="nx">@triggerPinchOrSpread</span><span class="p">()</span>
				<span class="nx">@triggerRotation</span><span class="p">()</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>Trigger all names related to the drag direction</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">triggerDragDirections: </span><span class="o">-&gt;</span>
		<span class="nv">gestureName = </span><span class="p">[]</span>
		<span class="nx">gestureName</span><span class="p">.</span><span class="nx">push</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span> <span class="k">for</span> <span class="nx">finger</span> <span class="k">in</span> <span class="nx">@fingers</span>
		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">gestureName</span><span class="p">,</span> <span class="nx">@informations</span> <span class="k">if</span> <span class="o">!</span><span class="nx">gestureName</span><span class="p">.</span><span class="nx">contains</span> <span class="s2">&quot;unknown&quot;</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>Test if the drag is a pinch or a spread</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">triggerPinchOrSpread: </span><span class="o">-&gt;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Spread and Pinch detection</p>             </td>             <td class="code">               <div class="highlight"><pre>		<span class="nv">sameDirection = </span><span class="kc">false</span>
		<span class="k">for</span> <span class="nx">finger</span> <span class="k">in</span> <span class="nx">@fingers</span>
			<span class="nx">alert</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span> 
		<span class="k">if</span> <span class="nx">@informations</span><span class="p">.</span><span class="nx">scale</span> <span class="o">&lt;</span> <span class="mf">1.1</span> <span class="o">and</span> <span class="o">!</span><span class="nx">sameDirection</span>
			<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="s2">&quot;#{digit_name(@fingers.length)}:pinch&quot;</span><span class="p">,</span> <span class="nx">@informations</span>
			<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="s2">&quot;pinch&quot;</span><span class="p">,</span> <span class="nx">@informations</span>
		<span class="k">else</span> <span class="k">if</span> <span class="nx">@informations</span><span class="p">.</span><span class="nx">scale</span> <span class="o">&gt;</span> <span class="mf">1.1</span> <span class="o">and</span> <span class="o">!</span><span class="nx">sameDirection</span>
			<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="s2">&quot;#{digit_name(@fingers.length)}:spread&quot;</span><span class="p">,</span> <span class="nx">@informations</span>
			<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="s2">&quot;spread&quot;</span><span class="p">,</span> <span class="nx">@informations</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Trigger all names related to the fixed event</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">triggerFixed: </span><span class="o">-&gt;</span>
		<span class="k">if</span> <span class="nx">@gestureName</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="o">and</span> <span class="nx">@gestureName</span><span class="p">.</span><span class="nx">contains</span> <span class="s2">&quot;fixed&quot;</span>
			<span class="nv">dontTrigger = </span><span class="kc">false</span>
			<span class="nv">gestureName = </span><span class="p">[]</span>
			<span class="k">for</span> <span class="nx">finger</span> <span class="k">in</span> <span class="nx">@fingers</span>
				<span class="k">if</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">gestureName</span> <span class="o">==</span> <span class="s2">&quot;drag&quot;</span> <span class="o">and</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span> <span class="o">==</span> <span class="s2">&quot;triggerDrag&quot;</span>
					<span class="nv">dontTrigger = </span><span class="kc">true</span>
					<span class="k">break</span>
				<span class="k">if</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">gestureName</span> <span class="o">==</span> <span class="s2">&quot;drag&quot;</span> <span class="k">then</span> <span class="nx">gestureName</span><span class="p">.</span><span class="nx">push</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span> <span class="k">else</span> <span class="nx">gestureName</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;fixed&quot;</span>
			<span class="k">if</span> <span class="o">!</span><span class="nx">dontTrigger</span>
				<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">gestureName</span><span class="p">,</span> <span class="nx">@informations</span>
			</pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p>Trigger all names related to the flick event</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">triggerFlick: </span><span class="o">-&gt;</span>
		<span class="k">if</span> <span class="nx">@gestureName</span><span class="p">.</span><span class="nx">contains</span> <span class="s2">&quot;dragend&quot;</span>
			<span class="nv">gestureName1 = </span><span class="p">[]</span>
			<span class="nv">gestureName2 = </span><span class="p">[]</span>
			<span class="nv">dontTrigger = </span><span class="kc">false</span>
			<span class="k">for</span> <span class="nx">finger</span> <span class="k">in</span> <span class="nx">@fingers</span>
				<span class="k">if</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span> <span class="o">==</span> <span class="s2">&quot;unknown&quot;</span> <span class="k">then</span> <span class="nv">dontTrigger = </span><span class="kc">true</span>
				<span class="k">if</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">isFlick</span>
					<span class="nx">gestureName1</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;flick:#{finger.params.dragDirection}&quot;</span>
					<span class="nx">gestureName2</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;flick&quot;</span>
				<span class="k">else</span>
					<span class="nx">gestureName1</span><span class="p">.</span><span class="nx">push</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span>
					<span class="nx">gestureName2</span><span class="p">.</span><span class="nx">push</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span>
			<span class="k">if</span> <span class="o">!</span><span class="nx">dontTrigger</span>
				<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">gestureName1</span><span class="p">,</span> <span class="nx">@informations</span>
				<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">gestureName2</span><span class="p">,</span> <span class="nx">@informations</span>
		</pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p>Trigger if it is a rotation, and specify if it is clockwise or counterclockwise</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">triggerRotation: </span><span class="o">-&gt;</span> 
		<span class="k">if</span> <span class="o">!</span><span class="nx">@lastRotation</span><span class="o">?</span>
			<span class="vi">@lastRotation = </span><span class="nx">@informations</span><span class="p">.</span><span class="nx">rotation</span>
		<span class="nv">rotationDirection = </span><span class="s2">&quot;&quot;</span>
		<span class="k">if</span> <span class="nx">@informations</span><span class="p">.</span><span class="nx">rotation</span> <span class="o">&gt;</span> <span class="nx">@lastRotation</span> <span class="k">then</span> <span class="nv">rotationDirection = </span><span class="s2">&quot;rotate:cw&quot;</span> <span class="k">else</span> <span class="nv">rotationDirection = </span><span class="s2">&quot;rotate:ccw&quot;</span>	</pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>@lastRotation = @informations.rotation</p>             </td>             <td class="code">               <div class="highlight"><pre>		
		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">rotationDirection</span><span class="p">,</span> <span class="nx">@informations</span>
		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="s2">&quot;rotate&quot;</span><span class="p">,</span> <span class="nx">@informations</span>
		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="s2">&quot;#{digit_name(@fingers.length)}:#{rotationDirection}&quot;</span><span class="p">,</span> <span class="nx">@informations</span>
		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="s2">&quot;#{digit_name(@fingers.length)}:rotate&quot;</span><span class="p">,</span> <span class="nx">@informations</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p>Trigger combination of names which are like "one:....,two:..." etc.</p>             </td>             <td class="code">               <div class="highlight"><pre>	<span class="nv">generateGrouppedFingerName: </span><span class="o">-&gt;</span> 
		<span class="nv">gestureName = </span><span class="p">[]</span> 
		<span class="nv">gestureNameDrag = </span><span class="p">[]</span>
		<span class="nv">triggerDrag = </span><span class="kc">false</span>
		<span class="nv">gestures = </span>
			<span class="nv">tap: </span><span class="mi">0</span>
			<span class="nv">doubletap: </span><span class="mi">0</span>
			<span class="nv">fixed: </span><span class="mi">0</span>
			<span class="nv">fixedend: </span><span class="mi">0</span>
			<span class="nv">drag: </span><span class="mi">0</span>
			<span class="nv">dragend: </span><span class="p">{</span><span class="nv">n: </span><span class="mi">0</span><span class="p">,</span> <span class="nv">fingers: </span><span class="p">[]}</span>
			<span class="nv">dragDirection:</span>
				<span class="nv">up: </span><span class="mi">0</span>
				<span class="nv">down: </span><span class="mi">0</span>
				<span class="nv">left: </span><span class="mi">0</span>
				<span class="nv">right: </span><span class="mi">0</span>
				<span class="nv">drag: </span><span class="mi">0</span>
		
		<span class="k">for</span> <span class="nx">finger</span> <span class="k">in</span> <span class="nx">@fingers</span>
			<span class="k">switch</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">gestureName</span>
				<span class="k">when</span> <span class="s2">&quot;tap&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">tap</span><span class="o">++</span>
				<span class="k">when</span> <span class="s2">&quot;doubletap&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">doubletap</span><span class="o">++</span>
				<span class="k">when</span> <span class="s2">&quot;fixed&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">fixed</span><span class="o">++</span>
				<span class="k">when</span> <span class="s2">&quot;fixedend&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">fixedend</span><span class="o">++</span>
				<span class="k">when</span> <span class="s2">&quot;dragend&quot;</span> 
					<span class="nx">gestures</span><span class="p">.</span><span class="nx">dragend</span><span class="p">.</span><span class="nx">n</span><span class="o">++</span>
					<span class="nx">gestures</span><span class="p">.</span><span class="nx">dragend</span><span class="p">.</span><span class="nx">fingers</span><span class="p">.</span><span class="nx">push</span> <span class="nx">finger</span>
				<span class="k">when</span> <span class="s2">&quot;drag&quot;</span>
					<span class="nx">gestures</span><span class="p">.</span><span class="nx">drag</span><span class="o">++</span>
					<span class="k">switch</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">dragDirection</span>
						<span class="k">when</span> <span class="s2">&quot;up&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">dragDirection</span><span class="p">.</span><span class="nx">up</span><span class="o">++</span>
						<span class="k">when</span> <span class="s2">&quot;down&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">dragDirection</span><span class="p">.</span><span class="nx">down</span><span class="o">++</span>
						<span class="k">when</span> <span class="s2">&quot;right&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">dragDirection</span><span class="p">.</span><span class="nx">right</span><span class="o">++</span>
						<span class="k">when</span> <span class="s2">&quot;left&quot;</span> <span class="k">then</span> <span class="nx">gestures</span><span class="p">.</span><span class="nx">dragDirection</span><span class="p">.</span><span class="nx">left</span><span class="o">++</span>
		<span class="k">for</span> <span class="nx">gesture</span> <span class="k">of</span> <span class="nx">gestures</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p>For the flick, I consider that if two drag end has been done at the same time and one of them is
a flick, both of them where flick</p>             </td>             <td class="code">               <div class="highlight"><pre>			<span class="k">if</span> <span class="nx">gesture</span> <span class="o">==</span> <span class="s2">&quot;dragend&quot;</span> <span class="o">and</span> <span class="nx">gestures</span><span class="p">[</span><span class="nx">gesture</span><span class="p">].</span><span class="nx">n</span> <span class="o">&gt;</span> <span class="mi">0</span>
				<span class="k">for</span> <span class="nx">finger</span> <span class="k">in</span> <span class="nx">gestures</span><span class="p">[</span><span class="nx">gesture</span><span class="p">].</span><span class="nx">fingers</span>
					<span class="k">if</span> <span class="nx">finger</span><span class="p">.</span><span class="nx">isFlick</span>
						<span class="nx">gestureName</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;#{digit_name(gestures[gesture].n)}:flick&quot;</span> 
						<span class="nx">gestureNameDrag</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;#{digit_name(gestures[gesture].n)}:flick:#{finger.params.dragDirection}&quot;</span>
						<span class="nv">triggerDrag = </span><span class="kc">true</span>
						<span class="k">break</span>
			<span class="k">else</span> <span class="k">if</span> <span class="nx">gesture</span> <span class="o">==</span> <span class="s2">&quot;dragDirection&quot;</span>
				<span class="k">for</span> <span class="nx">gestureDirection</span> <span class="k">of</span> <span class="nx">gestures</span><span class="p">[</span><span class="nx">gesture</span><span class="p">]</span>
					<span class="k">if</span> <span class="nx">gestures</span><span class="p">[</span><span class="nx">gesture</span><span class="p">][</span><span class="nx">gestureDirection</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
						<span class="nx">gestureNameDrag</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;#{digit_name(gestures[gesture][gestureDirection])}:#{gestureDirection}&quot;</span> 
						<span class="nv">triggerDrag = </span><span class="kc">true</span>
			<span class="k">else</span> <span class="k">if</span> <span class="nx">gestures</span><span class="p">[</span><span class="nx">gesture</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span>
				<span class="nx">gestureName</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;#{digit_name(gestures[gesture])}:#{gesture}&quot;</span>
				<span class="nx">gestureNameDrag</span><span class="p">.</span><span class="nx">push</span> <span class="s2">&quot;#{digit_name(gestures[gesture])}:#{gesture}&quot;</span> <span class="k">if</span> <span class="nx">gesture</span> <span class="o">!=</span> <span class="s2">&quot;drag&quot;</span>

		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">gestureName</span><span class="p">,</span> <span class="nx">@informations</span> <span class="k">if</span> <span class="nx">gestureName</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">0</span>
		<span class="nx">@targetElement</span><span class="p">.</span><span class="nx">trigger</span> <span class="nx">gestureNameDrag</span><span class="p">,</span> <span class="nx">@informations</span> <span class="k">if</span> <span class="nx">triggerDrag</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 